---
title: åŠ¨æ€åˆ›å»ºç±»æ•°ç»„
date: 2023-01-01 16:22:56
tags:
      - gwx
      - c++
---



# åŠ¨æ€åˆ›å»ºç±»æ•°ç»„ï¼ŒåŒæ—¶è°ƒç”¨ç±»çš„æ„é€ å‡½æ•°



è¿™æ˜¯æˆ‘é“å“¥ä»¬gwxçš„blogï¼ŒæŒ‚åœ¨æˆ‘è¿™é‡Œè®©æˆ‘ç»ä»°ç»ä»° ğŸ˜

è¿™å¯æ¯”æˆ‘çš„å“ªäº›åƒåœ¾blogæœ‰ä»·å€¼å¤šäº† ğŸ˜­ğŸ˜­





<!-- more -->

åœ¨å†™ä»£ç çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬ç»å¸¸ä¼šé‡è§è¿™æ ·çš„é—®é¢˜

```
#include <iostream>
#include <cstdlib>
#include <new>
using namespace std;

class test
{
public:
    int data;

    test(int n)
    {
        cout << "æ„é€ :";
        data = n;
        cout << n << endl;
    }
    ~test(){ cout << "ææ„:" << data << endl;}
};

int main()
{
    test * a;
    a=new test[10];//è¿™é‡Œæƒ³è¦è®©a[i]ä¾æ¬¡è°ƒç”¨test(2*i)ä½†æ˜¯ä¼šæŠ¥é”™
    return 0;
}

```

å¯¼è‡´æŠ¥é”™çš„é—®é¢˜ï¼Œä¸»è¦åŸå› æ˜¯ç±»æ²¡æœ‰é»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œè€Œæˆ‘ä»¬åˆå¸Œæœ›åœ¨æ„å»ºç±»æ•°ç»„çš„æ—¶å€™ç»™å®ƒä¼ é€’ä¸€äº›åŠ¨æ€å˜åŒ–çš„å‚æ•°è¯¥æ€ä¹ˆåŠï¼Œä»¥ä¸‹æœ‰ä¸‰ç§æ–¹æ³•ï¼š

## 1 è®¤æ€‚

æ²¡é”™ï¼Œæ—¢ç„¶å®ç°ä¸äº†å°±è®¤æ€‚å‘—ï¼Œå°†æ„é€ å‡½æ•°çš„åŠŸèƒ½åˆ†å¼€ã€‚å…ˆå†™ä¸€ä¸ªé»˜è®¤æ„é€ å‡½æ•°ï¼Œç„¶åå†ç”¨å…¶ä»–æˆå‘˜å‡½æ•°å®ç°åŠŸèƒ½ã€‚å¦‚ä¸‹ï¼š

```
#include <iostream>
#include <cstdlib>
#include <new>
using namespace std;

class test
{
public:
    int data;
    test(){};
    void func(int n)
    {
        cout << "func:";
        data = n;
        cout << n << endl;
    }
    ~test(){ cout << "ææ„:" << data << endl;}
};

int main()
{
    test * a;
    a=new test[10];
    for(int i=0;i<10;i++)
        a[i].func(i*2);
    delete [] a;
    return 0;
}

```

## 2 æŒ‡é’ˆ

ä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆèƒ½è®©è¿™ç§ä¸œè¥¿æ‰“è´¥ï¼Œèªæ˜çš„ä½ ä¸€å®šæƒ³åˆ°è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ã€‚ç„¶åå†åŠ¨æ€çš„ç»™æŒ‡é’ˆæ•°ç»„æ„é€ å¯¹è±¡ã€‚å¦‚ä¸‹ï¼š

```
#include <iostream>
#include <cstdlib>
#include <new>
using namespace std;

class test
{
public:
    int data;
    test(int n)
    {
        cout << "func:";
        data = n;
        cout << n << endl;
    }
    ~test(){ cout << "ææ„:" << data << endl;}
};

int main()
{
    test ** a;
    a=new test*[10];
    for(int i=0;i<10;i++)
        a[i]=new test(i*2);
    
    for(int i=0;i<10;i++)
        delete a[i];
    delele a;
    return 0;
}

```

è¿™æ ·çš„æ–¹æ³•ç¡®å®èƒ½å¤Ÿè§£å†³é—®é¢˜ï¼Œä½†æ˜¯è¿˜å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚è¿™ç§æ–¹æ³•å¹¶æ²¡æœ‰åˆ›å»ºä¸€ä¸ªçœŸæ­£çš„æ•°ç»„ï¼Œè€Œæ˜¯åˆ›å»ºäº†æŒ‡é’ˆçš„æ•°ç»„ï¼Œå®é™…ä¸Šå¤šæµªè´¹äº†ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„çš„ç©ºé—´ï¼ŒåŒæ—¶å¦‚æœç”¨

```
sizeof(a[0]);
```

è¿™æ ·çš„å‡½æ•°å¹¶ä¸ä¼šå¾—åˆ°a[0]çš„å¤§å°ï¼Œè€Œæ˜¯å¾—åˆ°ä¸€ä¸ªæŒ‡é’ˆçš„å¤§å°ã€‚

## 3 å®šä½new

ç¬¬ä¸‰ç§æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨å®šä½newã€‚ï¼ˆéœ€è¦åŒ…å«newå¤´æ–‡ä»¶ï¼‰   
åœ¨è®²è§£å®šä½newä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹newæ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚
newè¯ç”Ÿçš„åŸå› å°±æ˜¯å› ä¸ºcè¯­è¨€çš„mallocåœ¨é¢å¯¹ç±»çš„æ„é€ å‡½æ•°æœ‰ç‚¹åŠ›ä¸ä»å¿ƒã€‚mallocçš„ä½œç”¨ä»…ä»…æ˜¯åˆ†é…ç©ºé—´ã€‚

``` 
(test *)malloc(sizeof(test));
```

å®é™…ä¸Šæ²¡æœ‰è°ƒç”¨testç±»çš„æ„é€ å‡½æ•°ï¼Œä»…ä»…åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªtestå¤§å°çš„å†…å­˜ç©ºé—´è€Œå·²ã€‚è€Œnewå®é™…ä¸Šæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œç¬¬ä¸€ä¸ªå’Œmallocä¸€æ ·ï¼šå‘æ“ä½œç³»ç»Ÿç”³è¯·ç©ºé—´ï¼Œè€Œç¬¬äºŒä¸ªåˆ™æ˜¯è°ƒç”¨å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚   
è€Œå®šä½newæ˜¯åˆ™æ˜¯ç»™newåŠ äº†ä¸€ä¸ªåŠŸèƒ½ï¼Œå°±æ˜¯åœ¨ä½ æŒ‡å®šçš„ç©ºé—´ä¸­newä¸€ä¸ªå¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯ä¸å‘æ“ä½œç³»ç»Ÿç”³è¯·ç©ºé—´ï¼Œç›´æ¥åœ¨æŒ‡å®šçš„åœ°å€è°ƒç”¨å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚å®šä½newçš„ä½¿ç”¨æ–¹æ³•

```
    new(æŒ‡å®šçš„åœ°å€) test(i);
```

ç°åœ¨è¿™ä¸ªé—®é¢˜å°±ç®€å•äº†ï¼Œåªéœ€è¦æˆ‘ä»¬ç”³è¯·ä¸€å—ç©ºé—´ï¼Œç„¶åç”¨å®šä½newè°ƒç”¨æ„é€ å‡½æ•°å³å¯ã€‚

```
#include <iostream>
#include <cstdlib>
#include <new>
using namespace std;

class test
{
public:
    int data;

    test(int n)
    {
        cout << "æ„é€ :";
        data = n;
        cout << n << endl;
    }
    ~test(){ cout << "ææ„:" << data << endl;}
};

int main()
{
    test *ptr;
    int size = 10;
    test *buffer = (test *)malloc(size * sizeof(test));
    for (int i = 0; i < 10; i++)
    {
        new (buffer + i) test(i * 2);
    }

    ptr = buffer;
    for (int i = 0; i < 10; i++)
    {
        ptr->~test();
        ptr++;
    }
    free(buffer);

    return 0;
}
```

è¿™é‡Œå…ˆç”¨mallocåˆ›å»ºäº†æ•°ç»„çš„ç©ºé—´ï¼Œç„¶åç”¨newè°ƒç”¨äº†æ„é€ å‡½æ•°ï¼Œæœ€åç”¨æŒ‡é’ˆè°ƒç”¨å¯¹è±¡çš„ææ„å‡½æ•°ï¼ŒåŒæ—¶freeæ‰åˆ›å»ºçš„ç©ºé—´ã€‚

